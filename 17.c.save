/*Write a program to simulate online ticket reservation. Implement write lock
Write a program to open a file, store a ticket number and exit. Write a separate program, to
open the file, implement write lock, read the ticket number, increment the number and print
the new ticket number then close the file.*/
#include<stdio.h>
#include<stdlib.h>
#include<fcntl.h>
#include<sys/types.h>
#include<sys/stat.h>
int main(void)
{ struct {int ticket_no;}db;
struct flock lock;
int fd;
lock.l_type=F_WRLCK;
lock.l_start=0;
lock.l_whence=SEEK_SET;
lock.l_pid=getpid();
lock.l_len=0;
fd=open("db",O_RDWR|O_CREAT,0744);
printf("before eterning cs\n");
fcntl(fd,F_SETLKW,&lock);
printf("inside cs");
printf("current tickect no. %d\n",db.ticket_no);
db.ticket_no ++;
lseek(fd,0L,SEEK_SET);
printf("ticket no. after updation %d\n",db.ticket_no);
printf("press enter to exit cs\n");
getchar();
lock.l_type=F_UNLCK;
fcntl(fd,F_SETLK,&lock);
printf("exited cs\n");
}
